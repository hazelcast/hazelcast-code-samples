name: Builder

on:
  pull_request_target:

jobs:
  check_for_membership:
    runs-on: ubuntu-latest
    name: Check PR author membership
    outputs:
      check-result: ${{ steps.composite.outputs.check-result }}
    steps: 
      - name: Action for membership check
        id: composite
        uses: hazelcast/hazelcast-tpm/membership@main
        with:
          organization-name: 'hazelcast'
          member-name: ${{ github.event.pull_request.head.repo.owner.login }}
          token: ${{ secrets.GH_TOKEN }}
  pr-builder:
    runs-on: ubuntu-latest
    needs: [check_for_membership]
    steps:
      - name: Detect untrusted community PR
        if: ${{ needs.check_for_membership.outputs.check-result == 'false' }}
        run: |
          echo "::error::ERROR: Untrusted external PR. Must be reviewed and executed by Hazelcast" 1>&2;
          exit 1
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: 17
          distribution: temurin
      - name: Build and test
        run: |
          ${RUNNER_DEBUG:+set -x}
          ls -al
